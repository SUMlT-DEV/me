<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Detailed Device Info Collector</title>
</head>
<body>
  <h1>Collecting Device Info...</h1>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
    import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAPnIdzRwgSyXGim2464L7HbqWdC74zMGQ",
      authDomain: "fir-ace16.firebaseapp.com",
      databaseURL: "https://fir-ace16-default-rtdb.firebaseio.com",
      projectId: "fir-ace16",
      storageBucket: "fir-ace16.firebasestorage.app",
      messagingSenderId: "146082567791",
      appId: "1:146082567791:web:1ab04558bf3dcd0e8d1f9a"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Function to extract device name from userAgent
    function getDeviceNameFromUserAgent() {
      const ua = navigator.userAgent;
      
      // Android device detection
      if (ua.includes('Android')) {
        const match = ua.match(/Android.*?([A-Z][a-z]+)/);
        if (match) return match[1];
      }
      
      // iPhone
      if (ua.includes('iPhone')) return 'iPhone';
      if (ua.includes('iPad')) return 'iPad';
      if (ua.includes('iPod')) return 'iPod';
      
      // Windows
      if (ua.includes('Windows')) return 'Windows PC';
      
      // Mac
      if (ua.includes('Macintosh')) return 'Mac';
      
      // Linux
      if (ua.includes('Linux')) return 'Linux PC';
      
      return 'Unknown Device';
    }

    async function collectDeviceInfo() {
      let batteryInfo = { level: 'Not supported', charging: 'Not supported' };
      if (navigator.getBattery) {
        const battery = await navigator.getBattery();
        batteryInfo.level = (battery.level * 100).toFixed(0) + '%';
        batteryInfo.charging = battery.charging ? 'Yes' : 'No';
      }

      const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
      const connectionType = connection ? connection.effectiveType || connection.type : 'Not supported';

      let vrDisplays = [];
      if (navigator.getVRDisplays) {
        const displays = await navigator.getVRDisplays();
        vrDisplays = displays.map(d => d.displayName || 'VR Display');
      } else {
        vrDisplays = ['Not supported'];
      }

      return {
        deviceName: getDeviceNameFromUserAgent(),
        userAgent: navigator.userAgent,
        platform: navigator.platform || 'Not supported',
        batteryLevel: batteryInfo.level,
        charging: batteryInfo.charging,
        screenWidth: window.screen.width,
        screenHeight: window.screen.height,
        colorDepth: window.screen.colorDepth || 'Not supported',
        deviceMemory: navigator.deviceMemory || 'Not supported',
        hardwareConcurrency: navigator.hardwareConcurrency || 'Not supported',
        language: navigator.language || 'Not supported',
        vendor: navigator.vendor || 'Not supported',
        timezoneOffsetMinutes: new Date().getTimezoneOffset(),
        online: navigator.onLine,
        touchSupport: 'maxTouchPoints' in navigator ? navigator.maxTouchPoints : 'Not supported',
        connectionType: connectionType,
        vrDisplays: vrDisplays,
        timestamp: new Date().toISOString()
      };
    }

    async function sendToFirebase() {
      const info = await collectDeviceInfo();
      const deviceInfosRef = ref(db, 'deviceInfos');
      const newEntryRef = push(deviceInfosRef);
      set(newEntryRef, info)
        .then(() => console.log('Device info saved:', info))
        .catch((error) => console.error('Error saving device info:', error));
    }

    window.onload = () => {
      sendToFirebase();
    };
  </script>
</body>
</html>
