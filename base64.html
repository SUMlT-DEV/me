<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Base64 Converter</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom scrollbar for textareas */
        textarea::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        textarea::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }
        textarea::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        textarea::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="min-h-screen bg-slate-50 text-slate-800 font-sans selection:bg-indigo-100 selection:text-indigo-700">

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-10">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 h-16 flex items-center justify-between">
            <div class="flex items-center space-x-2">
                <div class="bg-indigo-600 p-2 rounded-lg">
                    <i data-lucide="code" class="w-5 h-5 text-white"></i>
                </div>
                <h1 class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-600 to-violet-600">
                    Base64<span class="font-medium text-slate-600">Converter</span>
                </h1>
            </div>
            <div class="text-xs font-medium px-3 py-1 bg-indigo-50 text-indigo-700 rounded-full border border-indigo-100 hidden sm:block">
                Secure client-side conversion
            </div>
        </div>
    </header>

    <main class="max-w-5xl mx-auto px-4 sm:px-6 py-8">
        
        <!-- Navigation Tabs -->
        <div class="flex justify-center mb-8">
            <div class="bg-white p-1 rounded-xl shadow-sm border border-slate-200 inline-flex">
                <button onclick="switchTab('encode')" id="tab-encode" class="flex items-center space-x-2 px-6 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 bg-indigo-600 text-white shadow-md">
                    <i data-lucide="image" class="w-4 h-4"></i>
                    <span>Image to Base64</span>
                </button>
                <button onclick="switchTab('decode')" id="tab-decode" class="flex items-center space-x-2 px-6 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 text-slate-500 hover:text-slate-700 hover:bg-slate-50">
                    <i data-lucide="file-text" class="w-4 h-4"></i>
                    <span>Base64 to Image</span>
                </button>
            </div>
        </div>

        <!-- ENCODER VIEW -->
        <div id="view-encode" class="fade-in grid lg:grid-cols-2 gap-6 transition-all duration-300">
            <!-- Left Column: Upload -->
            <div class="space-y-4">
                <div 
                    id="drop-zone"
                    class="relative group border-2 border-dashed border-slate-300 rounded-2xl h-80 flex flex-col items-center justify-center transition-all duration-200 cursor-pointer overflow-hidden bg-white hover:border-indigo-400 hover:bg-slate-50"
                    onclick="triggerFileInput()"
                >
                    <input type="file" id="file-input" onchange="handleFileSelect(event)" accept="image/*,application/pdf" class="hidden" />
                    
                    <!-- Empty State -->
                    <div id="upload-placeholder" class="text-center p-6 pointer-events-none">
                        <div class="w-16 h-16 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-200">
                            <i data-lucide="upload" class="w-8 h-8"></i>
                        </div>
                        <h3 class="text-lg font-semibold text-slate-700">Upload Image or PDF</h3>
                        <p class="text-slate-500 mt-2 text-sm max-w-xs mx-auto">
                            Drag and drop your file here, or click to browse
                        </p>
                        <p class="text-xs text-slate-400 mt-4 uppercase tracking-wider font-medium">
                            PNG, JPG, GIF, WEBP, PDF
                        </p>
                    </div>

                    <!-- Preview State (Hidden by default) -->
                    <div id="upload-preview" class="hidden relative w-full h-full p-4 flex items-center justify-center">
                        <div id="preview-content" class="w-full h-full flex items-center justify-center">
                            <!-- Image or PDF icon will be injected here -->
                        </div>
                        <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center z-10">
                            <button class="bg-white text-slate-800 px-4 py-2 rounded-lg font-medium shadow-lg hover:bg-slate-100 transform translate-y-2 group-hover:translate-y-0 transition-all duration-200">
                                Change File
                            </button>
                        </div>
                    </div>
                </div>

                <!-- File Info Card -->
                <div id="file-info" class="hidden bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex items-center justify-between">
                    <div class="flex items-center space-x-3 overflow-hidden">
                        <div class="w-10 h-10 rounded-lg bg-indigo-50 flex items-center justify-center flex-shrink-0">
                            <i data-lucide="image" class="w-5 h-5 text-indigo-600"></i>
                        </div>
                        <div class="min-w-0">
                            <p id="file-name" class="text-sm font-medium text-slate-700 truncate">filename.png</p>
                            <p id="file-details" class="text-xs text-slate-500">0 KB • image/png</p>
                        </div>
                    </div>
                    <button onclick="clearEncoder(event)" class="p-2 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors" title="Remove file">
                        <i data-lucide="trash-2" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>

            <!-- Right Column: Output -->
            <div class="space-y-4 flex flex-col h-full">
                <div class="flex items-center justify-between">
                    <h2 class="text-lg font-semibold text-slate-800 flex items-center gap-2">
                        Base64 Output
                        <span id="status-badge" class="hidden text-xs font-normal text-slate-400 bg-slate-100 px-2 py-0.5 rounded-full">Ready</span>
                    </h2>
                    <div id="copy-btn-container" class="hidden">
                        <button onclick="copyToClipboard()" class="flex items-center space-x-1 text-sm bg-indigo-600 text-white px-3 py-1.5 rounded-lg hover:bg-indigo-700 transition-colors shadow-sm">
                            <i data-lucide="copy" class="w-4 h-4"></i>
                            <span>Copy</span>
                        </button>
                    </div>
                </div>

                <div class="relative flex-grow min-h-[320px] lg:min-h-0 bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden group">
                    <textarea 
                        id="base64-output" 
                        readonly 
                        class="hidden w-full h-full p-4 text-xs font-mono text-slate-600 bg-white resize-none focus:outline-none focus:ring-2 focus:ring-indigo-500/20"
                        spellcheck="false"></textarea>
                    
                    <div id="empty-output-state" class="absolute inset-0 flex flex-col items-center justify-center text-slate-400 bg-slate-50/50">
                        <i data-lucide="code" class="w-12 h-12 mb-3 opacity-20"></i>
                        <p class="text-sm">Upload a file to generate code</p>
                    </div>
                </div>

                <div id="output-meta" class="hidden grid grid-cols-2 gap-3 text-xs text-slate-500 bg-slate-100 p-3 rounded-lg border border-slate-200">
                    <div>
                        <span class="font-semibold block text-slate-700">Character Count</span>
                        <span id="char-count">0</span> chars
                    </div>
                    <div>
                        <span class="font-semibold block text-slate-700">MIME Type</span>
                        <span id="mime-type">Unknown</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- DECODER VIEW -->
        <div id="view-decode" class="hidden fade-in grid lg:grid-cols-2 gap-6 transition-all duration-300">
            <!-- Input Side -->
            <div class="space-y-4 flex flex-col h-full">
                <div class="flex items-center justify-between">
                    <h2 class="text-lg font-semibold text-slate-800">Paste Base64 Code</h2>
                    <div class="flex gap-2">
                        <button onclick="pasteFromClipboard()" class="text-xs bg-white border border-slate-300 hover:bg-slate-50 text-slate-700 px-3 py-1.5 rounded-lg transition-colors font-medium">
                            Paste
                        </button>
                        <button onclick="clearDecoder()" class="text-xs bg-white border border-slate-300 hover:border-red-300 hover:text-red-600 text-slate-700 px-3 py-1.5 rounded-lg transition-colors">
                            Clear
                        </button>
                    </div>
                </div>

                <textarea
                    id="decoder-input"
                    oninput="handleDecoderInput(this.value)"
                    placeholder="Paste your base64 string here (data:image/png... or data:application/pdf...)"
                    class="w-full h-80 lg:h-full p-4 text-xs font-mono text-slate-600 bg-white border-2 border-slate-200 rounded-2xl resize-none focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 transition-all shadow-sm"
                    spellcheck="false"
                ></textarea>
            </div>

            <!-- Output Side -->
            <div class="space-y-4">
                <div class="flex items-center justify-between h-[36px]">
                    <h2 id="decoder-preview-title" class="text-lg font-semibold text-slate-800">Preview</h2>
                    <button id="download-btn" onclick="downloadDecodedFile()" class="hidden flex items-center space-x-1 text-sm bg-indigo-600 text-white px-4 py-1.5 rounded-lg hover:bg-indigo-700 transition-colors shadow-sm">
                        <i data-lucide="download" class="w-4 h-4"></i>
                        <span>Download</span>
                    </button>
                </div>

                <div class="bg-slate-100 rounded-2xl border-2 border-slate-200 border-dashed h-80 lg:h-[calc(100%-3rem)] flex items-center justify-center overflow-hidden relative">
                    
                    <!-- Content Container -->
                    <div id="decoder-content" class="relative w-full h-full p-4 flex items-center justify-center hidden">
                        <!-- Dynamic Content (img or iframe) goes here -->
                    </div>

                    <!-- Empty State -->
                    <div id="decoder-empty" class="text-center text-slate-400 p-8">
                        <div class="flex flex-col items-center">
                            <i data-lucide="image" class="w-12 h-12 mb-3 opacity-20"></i>
                            <p class="text-sm">Preview will appear here</p>
                        </div>
                    </div>

                    <!-- Error State -->
                    <div id="decoder-error" class="hidden text-center text-slate-400 p-8">
                        <div class="text-red-500 flex flex-col items-center">
                            <i data-lucide="alert-circle" class="w-10 h-10 mb-2"></i>
                            <p class="font-medium">Invalid Base64 String</p>
                            <p class="text-xs opacity-75 mt-1">Ensure the string starts with "data:..."</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- Notification Toast -->
    <div id="notification" class="fixed bottom-4 right-4 px-4 py-3 rounded-lg shadow-lg border flex items-center space-x-2 transition-all duration-300 transform translate-y-20 opacity-0 z-50">
        <i id="notif-icon" data-lucide="check" class="w-4 h-4"></i>
        <span id="notif-msg" class="text-sm font-medium">Message</span>
    </div>

    <script>
        // Initialize Lucide Icons
        lucide.createIcons();

        // --- State Variables ---
        let currentFile = null;
        let encodedString = '';
        let decodedData = null;
        let decodedType = 'image';
        let debounceTimer;

        // --- Tab Switching ---
        function switchTab(tab) {
            const encodeView = document.getElementById('view-encode');
            const decodeView = document.getElementById('view-decode');
            const tabEncode = document.getElementById('tab-encode');
            const tabDecode = document.getElementById('tab-decode');

            if (tab === 'encode') {
                encodeView.classList.remove('hidden');
                decodeView.classList.add('hidden');
                
                // Style buttons
                tabEncode.className = "flex items-center space-x-2 px-6 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 bg-indigo-600 text-white shadow-md";
                tabDecode.className = "flex items-center space-x-2 px-6 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 text-slate-500 hover:text-slate-700 hover:bg-slate-50";
            } else {
                encodeView.classList.add('hidden');
                decodeView.classList.remove('hidden');

                // Style buttons
                tabDecode.className = "flex items-center space-x-2 px-6 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 bg-indigo-600 text-white shadow-md";
                tabEncode.className = "flex items-center space-x-2 px-6 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 text-slate-500 hover:text-slate-700 hover:bg-slate-50";
            }
            // Refresh icons just in case
            lucide.createIcons();
        }

        // --- Notifications ---
        function showNotification(message, type = 'success') {
            const el = document.getElementById('notification');
            const msgEl = document.getElementById('notif-msg');
            const iconEl = document.getElementById('notif-icon');

            msgEl.textContent = message;
            
            // Reset classes
            el.className = "fixed bottom-4 right-4 px-4 py-3 rounded-lg shadow-lg border flex items-center space-x-2 transition-all duration-300 transform z-50";
            
            if (type === 'error') {
                el.classList.add('bg-red-50', 'border-red-100', 'text-red-700', 'translate-y-0', 'opacity-100');
                // We'll just leave the check icon or replace manually, simple approach:
                // For simplicity in vanilla JS without re-rendering SVG, we just color the box.
            } else {
                el.classList.add('bg-emerald-50', 'border-emerald-100', 'text-emerald-700', 'translate-y-0', 'opacity-100');
            }

            setTimeout(() => {
                el.classList.remove('translate-y-0', 'opacity-100');
                el.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }

        // --- ENCODER LOGIC ---

        // Drag & Drop
        const dropZone = document.getElementById('drop-zone');
        
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('border-indigo-500', 'bg-indigo-50');
        });

        dropZone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            dropZone.classList.remove('border-indigo-500', 'bg-indigo-50');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('border-indigo-500', 'bg-indigo-50');
            
            const file = e.dataTransfer.files[0];
            validateAndProcessFile(file);
        });

        function triggerFileInput() {
            document.getElementById('file-input').click();
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            validateAndProcessFile(file);
        }

        function validateAndProcessFile(file) {
            if (!file) return;

            if (file.type.startsWith('image/') || file.type === 'application/pdf') {
                processFile(file);
            } else {
                showNotification('Please drop a valid image or PDF file', 'error');
            }
        }

        function processFile(file) {
            currentFile = file;

            // UI Updates
            document.getElementById('upload-placeholder').classList.add('hidden');
            document.getElementById('upload-preview').classList.remove('hidden');
            document.getElementById('file-info').classList.remove('hidden');
            
            // File Info
            document.getElementById('file-name').textContent = file.name;
            document.getElementById('file-details').textContent = `${(file.size / 1024).toFixed(1)} KB • ${file.type}`;

            // Preview Logic
            const previewContent = document.getElementById('preview-content');
            if (file.type === 'application/pdf') {
                previewContent.innerHTML = `
                    <div class="flex flex-col items-center justify-center text-slate-500">
                        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mb-3 shadow-sm"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><path d="M16 13H8"></path><path d="M16 17H8"></path><path d="M10 9H8"></path></svg>
                        <span class="font-medium text-slate-700 bg-white px-3 py-1 rounded-full shadow-sm border border-slate-200">PDF Document</span>
                    </div>
                `;
            } else {
                const objectUrl = URL.createObjectURL(file);
                previewContent.innerHTML = `<img src="${objectUrl}" class="max-w-full max-h-full object-contain rounded-lg shadow-sm" />`;
            }

            // Convert Logic
            const reader = new FileReader();
            reader.onloadend = () => {
                encodedString = reader.result;
                const outputArea = document.getElementById('base64-output');
                outputArea.value = encodedString;
                outputArea.classList.remove('hidden');
                document.getElementById('empty-output-state').classList.add('hidden');
                
                document.getElementById('status-badge').classList.remove('hidden');
                document.getElementById('copy-btn-container').classList.remove('hidden');
                document.getElementById('output-meta').classList.remove('hidden');
                
                document.getElementById('char-count').textContent = encodedString.length.toLocaleString();
                // Extract clean mime type
                const mime = encodedString.split(';')[0].split(':')[1] || 'Unknown';
                document.getElementById('mime-type').textContent = mime;

                showNotification('File converted successfully!');
            };
            reader.onerror = () => {
                showNotification('Error reading file', 'error');
            };
            reader.readAsDataURL(file);
        }

        function clearEncoder(e) {
            if(e) e.stopPropagation();
            currentFile = null;
            encodedString = '';
            document.getElementById('file-input').value = '';
            
            // Reset UI
            document.getElementById('upload-placeholder').classList.remove('hidden');
            document.getElementById('upload-preview').classList.add('hidden');
            document.getElementById('file-info').classList.add('hidden');
            
            document.getElementById('base64-output').value = '';
            document.getElementById('base64-output').classList.add('hidden');
            document.getElementById('empty-output-state').classList.remove('hidden');
            
            document.getElementById('status-badge').classList.add('hidden');
            document.getElementById('copy-btn-container').classList.add('hidden');
            document.getElementById('output-meta').classList.add('hidden');
        }

        function copyToClipboard() {
            if (!encodedString) return;
            navigator.clipboard.writeText(encodedString)
                .then(() => showNotification('Base64 copied to clipboard'))
                .catch(() => {
                    // Fallback
                    const textarea = document.getElementById('base64-output');
                    textarea.select();
                    document.execCommand('copy');
                    showNotification('Base64 copied to clipboard');
                });
        }

        // --- DECODER LOGIC ---

        function handleDecoderInput(val) {
            clearTimeout(debounceTimer);
            
            if (!val.trim()) {
                clearDecoder();
                return;
            }

            debounceTimer = setTimeout(() => {
                try {
                    let cleanString = val.trim();
                    let detectedType = 'image';

                    if (cleanString.startsWith('data:application/pdf')) {
                        detectedType = 'pdf';
                    } 
                    else if (!cleanString.startsWith('data:image/')) {
                        if (cleanString.length > 100 && !cleanString.includes(',')) {
                            cleanString = `data:image/png;base64,${cleanString}`;
                        }
                    }

                    decodedType = detectedType;
                    decodedData = cleanString;
                    renderDecoderPreview();
                } catch (e) {
                    showDecoderError();
                }
            }, 500);
        }

        function renderDecoderPreview() {
            const contentDiv = document.getElementById('decoder-content');
            const emptyDiv = document.getElementById('decoder-empty');
            const errorDiv = document.getElementById('decoder-error');
            const downloadBtn = document.getElementById('download-btn');
            const title = document.getElementById('decoder-preview-title');

            errorDiv.classList.add('hidden');
            emptyDiv.classList.add('hidden');
            contentDiv.classList.remove('hidden');
            downloadBtn.classList.remove('hidden');

            title.textContent = decodedType === 'pdf' ? 'PDF Preview' : 'Image Preview';

            if (decodedType === 'pdf') {
                contentDiv.innerHTML = `<iframe src="${decodedData}" class="w-full h-full rounded shadow-sm bg-white"></iframe>`;
            } else {
                contentDiv.innerHTML = `
                    <div class="absolute inset-0 bg-[length:20px_20px] bg-[position:0_0,10px_10px] opacity-20 pointer-events-none" style="background-image: linear-gradient(45deg,#e2e8f0 25%,transparent 25%,transparent 75%,#e2e8f0 75%,#e2e8f0),linear-gradient(45deg,#e2e8f0 25%,transparent 25%,transparent 75%,#e2e8f0 75%,#e2e8f0);"></div>
                    <img src="${decodedData}" class="relative max-w-full max-h-full object-contain rounded shadow-lg z-10" onerror="showDecoderError()" />
                `;
            }
        }

        function showDecoderError() {
            document.getElementById('decoder-content').classList.add('hidden');
            document.getElementById('decoder-empty').classList.add('hidden');
            document.getElementById('decoder-error').classList.remove('hidden');
            document.getElementById('download-btn').classList.add('hidden');
        }

        function clearDecoder() {
            document.getElementById('decoder-input').value = '';
            decodedData = null;
            document.getElementById('decoder-content').classList.add('hidden');
            document.getElementById('decoder-error').classList.add('hidden');
            document.getElementById('decoder-empty').classList.remove('hidden');
            document.getElementById('download-btn').classList.add('hidden');
            document.getElementById('decoder-preview-title').textContent = 'Preview';
        }

        async function pasteFromClipboard() {
            try {
                const text = await navigator.clipboard.readText();
                document.getElementById('decoder-input').value = text;
                handleDecoderInput(text);
                showNotification('Pasted from clipboard');
            } catch (err) {
                showNotification('Unable to access clipboard', 'error');
            }
        }

        function downloadDecodedFile() {
            if (!decodedData) return;
            const link = document.createElement('a');
            link.href = decodedData;
            const ext = decodedType === 'pdf' ? 'pdf' : 'png';
            link.download = `converted-file-${Date.now()}.${ext}`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showNotification('Download started');
        }

    </script>
</body>
</html>
